<!DOCTYPE html>
<html lang="en">

<head>
    <title>Prueba Node</title>
    <script src="//cdn.pixelinnova.com/pixelone/pix-sistema.js"></script>
    <meta name="ROBOTS" content="NOINDEX, NOFOLLOW" />
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=.8, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto+Condensed:300,400,500,600" />
    <link rel="stylesheet" href="//cdn.pixelinnova.com/pixelone/fontawesome.all.min.css" />
    <link href="//cdn.pixelinnova.com/pixelone/pix-grid.css" rel="stylesheet" />
    <link href="//cdn.pixelinnova.com/pixelone/pix-sistema.css?v=01022023" rel="stylesheet" />
    <link href="//cdn.pixelinnova.com/pixelone/pix-menu-deslizante.css" rel="stylesheet" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#112233" />
    <meta name="msapplication-TileColor" content="#112233" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="stylesheet" href="css/custom.css">
    <link href="//cdn.jsdelivr.net/npm/jquery.fancytree@2.36.1/dist/skin-win8/ui.fancytree.min.css" rel="stylesheet">
    <link href="//cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css" rel="stylesheet">
    <style>
        #pixTarjetaFicha { margin-bottom: 0px !important;  }
        input[type=submit].btnCirculo{z-index:100}
    </style>
    <style>
        /* Estilo para cuando el campo tiene el foco */
        .pix-campo:focus-within label {
            transform: translateY(-25px);
            opacity: 0.7;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        /* Estilo para el label */
        .pix-campo label {
            position: absolute;
            pointer-events: none;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            transition: top 0.3s ease, font-size 0.3s ease, color 0.3s ease;
        }

        /* Estilo para cuando el campo tiene texto */
        .pix-campo input:not(:placeholder-shown) + label {
            top: 5px;
            font-size: 12px;
            color: #666;
        }
    </style>
    
</head>


<body class="pix-form-cargado">
    
    <header>
            
        <div><a class="btn-header btn-header-volver" href="#" data-pix-toltip="Volver" onclick="goBack()"><i class="far fa-arrow-left"></i></a></div>
        <div>
            <a class="pix-menu pix-menu--spring pix-boton-oculto">
                <span class="pix-menu-box">
                    <span class="pix-menu-inner"></span>
                </span>
            </a>
        </div>
        

        <div>
            <a id="btnPixContextual" class="btn-header pix-btn-mini-menu" href="#"><i class="far fa-ellipsis-v"></i></a>
            <div class="pix-mini-menu">
                <a href="/pix-admin/mi-cuenta"><i class="fas fa-user"></i>Mi cuenta</a>
                <a href="/login.aspx?logout=1"><i class="fas fa-power-off"></i>Cerrar sesión</a>
            </div>
        </div>
    </header>
    <form id="formularioEmpleado" enctype="multipart/form-data">
        <div class="pix-tarjeta-titulo">
            <i class="fas fa-folder-tree"></i>Formulario
        </div>
        <div class="pix-grid pad-8">
            <div class="pix-fila">
                <div class="pix-grid pad-8">
                    <div class="pc-12 tb-12 mv-12">
                        <img id="fotoEmpleado" src="#" alt="Foto del empleado" style="max-width: 100%; max-height: 300px;">
                    </div>
                </div>
                <div class="pix-upload cargado" data-ancho-img="200" data-alto-img="200"><input name="ctl00$CPH_Cuerpo$rptCampos$ctl01$ctl02 imagen" type="file" id="imagen" accept="image/*" title="Ningún archivo seleccionado"><input name="ctl00$CPH_Cuerpo$rptCampos$ctl01$ctlURL_IMAGEN" type="hidden" id="CPH_Cuerpo_rptCampos_ctlURL_IMAGEN_1" data-url-base-imagenes="https://oficinavirtual.pixelinnova.com" data-modo-corte-imageresizer="crop" data-modo-escala-imageresizer=""><label>Ningún archivo seleccionado</label></div>
                <div id="nombreField" class="pc-12 tb-12 mv-12">
                    <label for="nombre">Nombre</label>
                    <div class="pix-campo pix-relleno">
                        <input name="nombre" type="text" id="nombre" placeholder="Nombre" maxlength="200" required>
                        <div id="nombreContador" class="pix-contador-caracteres">0/200</div>
                    </div>
                </div>
                <div id="apellidoField" class="pc-12 tb-12 mv-12">
                    <label for="apellido">Apellidos</label>
                    <div class="pix-campo pix-relleno">
                        <input name="apellido" type="text" id="apellido" placeholder="Apellido" maxlength="200" required>
                        <div id="apellidoContador" class="pix-contador-caracteres">0/200</div>
                    </div>
                </div>
                <div id="emailField" class="pc-12 tb-12 mv-12">
                    <label for="email">Email</label>
                    <div class="pix-campo pix-relleno">
                        <input name="email" type="email" id="email" placeholder="Email" maxlength="200" required>
                        <div id="emailContador" class="pix-contador-caracteres">0/200</div>
                    </div>
                </div>
                <div id="telefonoField" class="pc-12 tb-12 mv-12">
                    <label for="telefono">Teléfono</label>
                    <div class="pix-campo pix-relleno">
                        <input name="telefono" type="text" id="telefono" placeholder="Teléfono" maxlength="200" required>
                        <div id="telefonoContador" class="pix-contador-caracteres">0/200</div>
                    </div>
                </div>
                <div class="pc-12 tb-12 mv-12">
                    <input name="ctl00$CPH_Acciones$btnGrabar" type="submit" id="btnGuardar" class="pix-validar-form btnCirculo btnAccionPrincipal" title="Grabar">
                </div>
            </div>
        </div>
    </form>
    <script>

        var nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ = -1;                                                                                                                                        
        var PERMISO_ROL_ACTUALpixFicherosProyectoWBTNNR89NKVRD7OS4CLJ = 2;                                                                                                                                        
                                                                                                                                                                                                         
        var pixFicheros = [];                                                                                                                                                                            
        var ficherosOK = 0;                                                                                                                                                                              
        var ficherosNOK = 0;                                                                                                                                                                             
        var resultadoFinal = '';                                                                                                                                                                         
                                                                                                                                                                                                         
        $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ .divArbolFicheros').fancytree({                                                                                                                 
            strings: {                                                                                                                                                                                   
                loading: 'Cargando&#8230;',                                                                                                                                   
                loadError: 'Error de carga',                                                                                                                               
                moreData: 'Más&#8230;', noData: 'No hay datos.'                                                                               
            },                                                                                                                                                                                           
                                                                                                                                                                                                         
            source: { url :'/funciones.ashx?funcion=obtenerArbolPixFicheros&token=pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ', cache: false },                                                                 
                                                                                                                                                                                                         
                                                                                                                                                                                                         
            init: function (e, data) {                                                                                                                                                                   
                                                                                                                                                                                                         
                if (nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ == -1) {                                                                                                                                                                  
                    var arrayFicherosPadres = data.tree.rootNode.children;                                                                                                                               
                    nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ = arrayFicherosPadres[0].key;                                                                                                                                             
                                                                                                                                                                                                         
                    obtenerFicherosDeNodo('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ',arrayFicherosPadres[0].key);                                                                                                          
                                                                                                                                                                                                         
                    actualizarMigas('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ',arrayFicherosPadres[0]);                                                                                                                    
                } else {                                                                                                                                                                                 
                    obtenerFicherosDeNodo('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ',nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ);                                                                                                                          
                    var nodo = $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ').find('.divArbolFicheros').fancytree('getTree').getNodeByKey(nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ);                                                    
                    nodo.setActive();                                                                                                                                                                      
                    nodo.setExpanded();                                                                                                                                                                  
                }                                                                                                                                                                                        
                                                                                                                                                                                                         
            },                                                                                                                                                                                           
            renderNode: function (e, data) {                                                                                                                                                             
                                                                                                                                                                                                         
                $(data.node.span).attr('data-id', data.node.key);                                                                                                                                        
                                                                                                                                                        
                                                                                                                                                                                                         
                var node = data.node;                                                                                                                                                                    
                var spanIcono = $(node.span).find('span.fancytree-icon');                                                                                                                                
                $(data.node.span).attr('data-token', node.data.token);                                                                                                                                        
                if (node.data.urlImagen != undefined && node.data.urlMiniatura != null && node.data.urlMiniatura != '') {                                                                                
                    spanIcono.css({ 'border-radius': '50%', 'background': 'url(' + node.data.urlMiniatura + '?w=16&h=16&mode=crop&autorotate=1)' });                                                     
                }                                                                                                                                                                                        
                                                                                                                                                                                                         
            },                                                                                                                                                                                           
            activate: function (e, data) {                                                                                                                                                               
                                                                                                                                                                                                         
                var nodoActual = data.node;                                                                                                                                                              
                nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ = nodoActual.key;                                                                                                                                                             
                                                                                                                                                                                                         
                                                                                                                                                                                                         
                if (nodoActual.folder) {                                                                                                                                                                 
                    obtenerFicherosDeNodo('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ',data.node.key);                                                                                                                       
                }                                                                                                                                                                                        
                                                                                                                                                                                                         
                actualizarMigas('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ',$('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ').find('.divArbolFicheros').fancytree('getTree').getNodeByKey(nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ));                         
                bindClickArchivoCarpetapixFicherosProyectoWBTNNR89NKVRD7OS4CLJ();                                                                                                                                                               
                                                                                                                                                                                                         
                                                                                                                                                                                                         
            },                                                                                                                                                                                           
            activeVisible: true, // Make sure, active nodes are visible (expanded)                                                                                                                       
            aria: true, // Enable WAI-ARIA support                                                                                                                                                       
            autoActivate: false, // Automatically activate a node when it is focused using keyboard                                                                                                      
            autoCollapse: true, // Automatically collapse all siblings, when a node is expanded                                                                                                          
            autoScroll: true, // Automatically scroll nodes into visible area                                                                                                                            
            clickFolderMode: 3, // 1:activate, 2:expand, 3:activate and expand, 4:activate (dblclick expands)                                                                                            
            checkbox: false, // Show check boxes                                                                                                                                                         
            checkboxAutoHide: undefined, // Display check boxes on hover only                                                                                                                            
            debugLevel: 1, // 0:quiet, 1:errors, 2:warnings, 3:infos, 4:debug                                                                                                                            
            disabled: false, // Disable control                                                                                                                                                          
            focusOnSelect: true, // Set focus when node is checked by a mouse click                                                                                                                      
            escapeTitles: false, // Escape `node.title` content for display                                                                                                                              
            generateIds: false, // Generate id attributes like <span id='fancytree-id-KEY'>                                                                                                              
            idPrefix: 'ft_', // Used to generate node id's like <span id='fancytree-id-<key>'>                                                                                                           
            icon: true, // Display node icons                                                                                                                                                            
            keyboard: false, // Support keyboard navigation                                                                                                                                              
            keyPathSeparator: '/', // Used by node.getKeyPath() and tree.loadKeyPath()                                                                                                                   
            minExpandLevel: 1, // 1: root node is not collapsible                                                                                                                                        
            quicksearch: false, // Navigate to next node by typing the first letters                                                                                                                     
            rtl: false, // Enable RTL (right-to-left) mode                                                                                                                                               
            selectMode: 1, // 1:single, 2:multi, 3:multi-hier                                                                                                                                            
            tabindex: '0', // Whole tree behaves as one single control                                                                                                                                   
            titlesTabbable: false, // Node titles can receive keyboard focus                                                                                                                             
            tooltip: true, // Use title as tooltip (also a callback could be specified)                                                                                                                  
                                                                                                                                                                                                         
        });                                                                                                                                                                                              
       
                                                                                                                                                                                             
                                                                                                                                                                                       
                                                                                                                                                                                       
           function bindClickArchivoCarpetapixFicherosProyectoWBTNNR89NKVRD7OS4CLJ() {                                                                                                                                        
               $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ a[data-carpeta]').on('click', function(e){                                                                                 
                   e.preventDefault();                                                                                                                                                 
                   var nodo = $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ').find('.divArbolFicheros').fancytree('getTree').getNodeByKey($(this).attr('data-carpeta'));                 
                   nodo.setActive();                                                                                                                                                         
                   nodo.setExpanded();                                                                                                                                                 
                                                                                                                                                                                       
               });                                                                                                                                                                     
           }                                                                                                                                                                           
                                                                                                                                                                                       
           bindClickArchivoCarpetapixFicherosProyectoWBTNNR89NKVRD7OS4CLJ();                                                                                                                                                  
                                                                                                                                                                                       
                                                                                                                                                                                       
           bindBotonesCarpeta('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ');                                                                                                                                                       
                                                                                                                                                                                       
           $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ .btnCambiarVista').click(function (e) {                                                                                    
               e.preventDefault();                                                                                                                                                     
               $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ').find('.divListaFicheros').attr('class', 'divListaFicheros').addClass($(this).attr('data-vista'));                         
           });                                                                                                                                                                         
                                                                                                                                                                                       
                                                                                                                                                                                       
           Fancybox.defaults.buttons = ['close'];                                                                                                                                      
           Fancybox.defaults.preload = 0;                                                                                                                                              
           Fancybox.defaults.l10n = {                                                                                                                                                  
               CLOSE: 'Cerrar',                                                                                                                       
               NEXT: 'Siguiente',                                                                                                                           
               PREV: 'Anterior',                                                                                                                      
               TOGGLE_FULLSCREEN: 'Pantalla completa',                                                                                                      
               TOGGLE_SLIDESHOW: 'Presentación',                                                                                                  
               TOGGLE_ZOOM: 'Zoom',                                                                                                                         
               TOGGLE_THUMBS: 'Miniaturas'                                                                                                            
           }                                                                                                                                                                                 
                                                                                                                                                                                       
                                                                                                                                                                                       
                                                                                                                                                                                       
                                                                                                                                                                                       
       
          function bindDraggablepixFicherosProyectoWBTNNR89NKVRD7OS4CLJ() {                                                                                                                                                              
                                                                                                                                                                                                  
          }                                                                                                                                                                                       
       
         function abrirFancyFicherospixFicherosProyectoWBTNNR89NKVRD7OS4CLJ() {                                                 
             $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ .btnEditarPixFichero').unbind('click').click(function (e) {
                 $('#divFancyFicheros').removeAttr('data-token');                                                                        
                 e.preventDefault();                                                     
                 cargarContenidoFancypixFicherosProyectoWBTNNR89NKVRD7OS4CLJ($(this));   
                 Fancybox.show(                                                          
                     [                                                                   
                         {                                                               
                             src: '#divFancyFicheros',                                   
                             type: 'inline',                                             
                         }                                                               
                     ]                                                                   
                 );                                                                      
             });                                                                         
             $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ .btnEditarPermisos').unbind('click').click(function (e) {
                 e.preventDefault();                                                     
                 $('#divFancyFicheros').removeAttr('data-token');                        
                 obtenerPermisosPixFicheros('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ');  
             });                                                                         
         }
         function cargarMiniaturaVideo(input) {                                                                                                                 
             $.ajax({                                                                                                                                            
                 type: 'Get',                                                                                                                                    
                 url: '/funciones.ashx',                                                                                                                         
                 data: {                                                                                                                                         
                     'funcion': 'cargar-miniatura',                                                                                                              
                     'urlVideo': input.val()                                                                                                                     
                 },                                                                                                                                              
                 success: function (resultado) {                                                                                                                 
                     if (resultado.VALOR == 1) {                                                                                                                 
                         if ($('.imgMiniatura img').attr('src') != resultado.TEXTO) {                                                                            
                             $('.imgMiniatura').remove();                                                                                                        
                             input.closest('.pix-grid').prepend($('<div>', { 'class': 'imgMiniatura' }).append($('<img>', { 'src': resultado.TEXTO })));         
                         }                                                                                                                                       
                     } else {                                                                                                                                    
                         $('.imgMiniatura').remove();                                                                                                            
                     }                                                                                                                                           
                 }, error: function (resultado) {                                                                                                                
                     $('.imgMiniatura').remove();                                                                                                                
                     console.error('No se han podido cargar la miniatura del vídeo');                                                                            
                 }                                                                                                                                               
             });                                                                                                                                                 
         }                                                                                                                                                       
       
            function cargarContenidoFancypixFicherosProyectoWBTNNR89NKVRD7OS4CLJ(pixFichero) {
              var id = pixFichero.attr('data-id');                                                                                                                                                                                                                                                                                  
              var tipo = pixFichero.attr('data-tipo');                                                                                                                                                                                                                                                                         
              var nombre = pixFichero.attr('data-nombre');                                                                                                                                                                                                                                                                              
              var enlace = pixFichero.attr('data-enlace');                                                                                                                                                                                                                                                                     
              var target = pixFichero.attr('data-target');                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                             
              var divFancyFicheros = $('#divFancyFicheros');                                                                                                                                                                                                                                                                            
              divFancyFicheros.attr('data-token', 'pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ');                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                  
              divFancyFicheros.empty();                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                  
              var divPixTarjeta = $('<div>', { class: 'pix-tarjeta' });                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                  
              if (tipo ==1) {                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                  
                if (id == -1) {                                                                                                                                                                                                                                                                                              
                    var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Nueva carpeta');                                                                                                                                                                                        
                    var iTitulo = $('<i>', { class: 'fas fa-folder-plus' });                                                                                                                                                                                                                                                 
                } else {                                                                                                                                                                                                                                                                                                          
                    var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Editar carpeta');                                                                                                                                                                                       
                    var iTitulo = $('<i>', { class: 'fas fa-folder' });                                                                                                                                                                                                                                                           
                }                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                  
              }                                                                                                                                                                                                                                                                                                                     
              else if (tipo ==2) {                                                                                                                                                                                                                                                             
                var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Editar imagen');                                                                                                                                                                                            
                var iTitulo = $('<i>', { class: 'fas fa-image' });                                                                                                                                                                                                                                                                
              }                                                                                                                                                                                                                                                                                                                
              else if (tipo ==3) {                                                                                                                                                                                                                                                            
                var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Editar archivo');                                                                                                                                                                                            
                var iTitulo = $('<i>', { class: 'fas fa-file-edit' });                                                                                                                                                                                                                                                            
              }                                                                                                                                                                                                                                                                                                                     
              else if ((tipo ==6) || (tipo ==5)) {                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                  
                if (id == -1) {                                                                                                                                                                                                                                                                                              
                    var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Nuevo vídeo');                                                                                                                                                                                          
                    var iTitulo = $('<i>', { class: 'fas fa-video' });                                                                                                                                                                                                                                                       
                } else {                                                                                                                                                                                                                                                                                                     
                    var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Editar vídeo');                                                                                                                                                                                         
                    var iTitulo = $('<i>', { class: 'fas fa-video' });                                                                                                                                                                                                                                                       
                }                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                  
              } else {                                                                                                                                                                                                                                                                                                              
                if (id == -1) {                                                                                                                                                                                                                                                                                              
                    var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Nuevo enlace');                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                             
                } else {                                                                                                                                                                                                                                                                                                          
                    var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Editar enlace');                                                                                                                                                                                        
                }                                                                                                                                                                                                                                                                                                                 
                var iTitulo = $('<i>', { class: 'fas fa-link' });                                                                                                                                                                                                                                                                 
              }                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                  
              tituloTarjeta.prepend(iTitulo);                                                                                                                                                                                                                                                                                       
              divPixTarjeta.append(tituloTarjeta);                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                  
              var divGrid = $('<div>', { class: 'pix-grid pad-8' });                                                                                                                                                                                                                                                                
              var divPixFila = $('<div>', { class: 'pix-fila' });                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                             
              var divPixCelda = $('<div>', { 'class': 'pc-12 tb-12 mv-12' });                                                                                                                                                                                                                                                       
              var divPixCampo = $('<div>', { 'class': 'pix-campo' });                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                  
              divPixCampo.append($('<label>').html('Nombre'));                                                                                                                                                                                                                                     
              if (id == -1)  {                                                                                                                                                                                                                                                                                                  
                divPixCampo.append($('<input>', { 'name': 'nombre', 'type': 'text', 'class': 'txtNombre', 'required': 'required', 'maxlength': '255', 'data-error': 'Por favor, introduce el nombre' }));                                                                                                             
                                                                                                                                                                                                                                                                                                                                  
              } else {                                                                                                                                                                                                                                                                                                              
                divPixCampo.append($('<input>', { 'name': 'nombre', 'value': nombre, 'type': 'text', 'class': 'txtNombre', 'required': 'required', 'maxlength': '255', 'data-error': 'Por favor, introduce el nombre' }));                                                                                            
              }                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                  
              divPixCelda.append(divPixCampo);                                                                                                                                                                                                                                                                                      
              divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                  
              if ((tipo ==6) || (tipo == 5)) {                                                                                                                                                                                                     
                divPixCelda = $('<div>', { 'class': 'pc-12 tb-12 mv-12' });                                                                                                                                                                                                                                                       
                divPixCampo = $('<div>', { 'class': 'pix-campo' });                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                  
                divPixCampo.append($('<label>').html('Enlace'));                                                                                                                                                                                                                                 
                if (id == -1) {                                                                                                                                                                                                                                                                                              
                    divPixCampo.append($('<input>', { 'name': 'enlace', 'type': 'url', 'class': 'txtEnlace txtEnlaceVideo', 'required': 'required', 'maxlength': '500', 'data-error': 'Por favor, introduce una URL válida' }));                                                                                                                 
                                                                                                                                                                                                                                                                                                                                  
                } else {                                                                                                                                                                                                                                                                                                          
                    divPixCampo.append($('<input>', { 'name': 'enlace', 'value': enlace, 'type': 'url', 'class': 'txtEnlace txtEnlaceVideo', 'required': 'required', 'maxlength': '500', 'data-error': 'Por favor, introduce una URL válida' }));                                                                                                
                                                                                                                                                                                                                                                                                                                             
                }                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                  
                divPixCelda.append(divPixCampo);                                                                                                                                                                                                                                                                                  
                divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                                                   
              } else if (tipo == 4) {                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                  
                divPixCelda = $('<div>', { 'class': 'pc-8 tb-12 mv-12' });                                                                                                                                                                                                                                                        
                divPixCampo = $('<div>', { 'class': 'pix-campo' });                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                  
                divPixCampo.append($('<label>').html('Enlace'));                                                                                                                                                                                                                                 
                if (id == -1) {                                                                                                                                                                                                                                                                                              
                    divPixCampo.append($('<input>', { 'name': 'enlace', 'type': 'url', 'class': 'txtEnlace', 'required': 'required', 'maxlength': '500', 'data-error': 'Por favor, introduce una url válida' }));                                                                                                                 
                                                                                                                                                                                                                                                                                                                                  
                } else {                                                                                                                                                                                                                                                                                                          
                    divPixCampo.append($('<input>', { 'name': 'enlace', 'value': enlace, 'type': 'url', 'class': 'txtEnlace', 'required': 'required', 'maxlength': '500', 'data-error': 'Por favor, introduce una url válida' }));                                                                                                
                }                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                  
                divPixCelda.append(divPixCampo);                                                                                                                                                                                                                                                                                  
                divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                  
                divPixCelda = $('<div>', { 'class': 'pc-4 tb-12 mv-12' });                                                                                                                                                                                                                                                        
                divPixCampo = $('<div>', { 'class': 'pix-label-fija' });                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                  
                var divCheck = $('<div>', { 'class': 'pix-check' });                                                                                                                                                                                                                                                              
                var labelEnlaceExterno = $('<label>').html('Abrir en una nueva pestaña');                                                                                                                                                                                                                 
                if (id!= -1 && !target) {                                                                                                                                                                                                                                                                               
                    labelEnlaceExterno.append($('<input>', { 'name': 'chkTarget', 'type': 'checkbox', 'class': 'chkTarget' }).prop('checked', false));                                                                                                                                                                            
                } else {                                                                                                                                                                                                                                                                                                     
                    labelEnlaceExterno.append($('<input>', { 'name': 'chkTarget', 'type': 'checkbox', 'class': 'chkTarget' }).prop('checked', true));                                                                                                                                                                             
                    labelEnlaceExterno.append($('<span>', { 'class': 'pix-marcado' }));                                                                                                                                                                                                                                      
                }                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                  
                divCheck.append(labelEnlaceExterno);                                                                                                                                                                                                                                                                              
                divPixCampo.append(divCheck);                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                  
                divPixCelda.append(divPixCampo);                                                                                                                                                                                                                                                                                  
                divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                  
            }                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                  
            if (id!= -1) {                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                  
                divPixCelda = $('<div>', { 'class': 'pc-6 tb-12 mv-12' });                                                                                                                                                                                                                                                        
                pixBtn = $('<button>', { 'type': 'submit', 'id': 'btnEliminarPixFichero', 'class': 'pix-btn', 'data-id': id, 'data-tipo': tipo }).html('<i class="fas fa-trash"></i>' + 'Eliminar');                                                                                             
                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                  
                divPixCelda.append(pixBtn);                                                                                                                                                                                                                                                                                       
                divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                  
                divPixCelda = $('<div>', { 'class': 'pc-6 tb-12 mv-12' });                                                                                                                                                                                                                                                        
                var pixBtn = $('<button>', { 'type': 'submit', 'id': 'btnGrabarPixFicheroFichero', 'class': 'pix-btn pix-validar-form pix-btn-verde', 'data-id': id, 'data-tipo': tipo, 'data-id-padre': nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ }).html('<i class="fas fa-save"></i>' + 'Guardar');                   
                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                  
                divPixCelda.append(pixBtn);                                                                                                                                                                                                                                                                                       
                divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                  
            } else {                                                                                                                                                                                                                                                                                                              
                divPixCelda = $('<div>', { 'class': 'pc-12 tb-12 mv-12' });                                                                                                                                                                                                                                                       
                var pixBtn = $('<button>', { 'type': 'submit', 'id': 'btnGrabarPixFicheroFichero', 'class': 'pix-btn pix-validar-form pix-btn-verde', 'data-id': id, 'data-tipo': tipo, 'data-id-padre': nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ }).html('<i class="fas fa-save"></i>' + 'Guardar');                 
                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                  
                divPixCelda.append(pixBtn);                                                                                                                                                                                                                                                                                       
                divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                                                   
            }                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                  
            divGrid.append(divPixFila);                                                                                                                                                                                                                                                                                           
            divPixTarjeta.append(divGrid);                                                                                                                                                                                                                                                                                        
            divFancyFicheros.append(divPixTarjeta);                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                  
            cargarCampos();                                                                                                                                                                                                                                                                                                       
            grabarPixFichero('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ');                                                                                                                                                                                                                                                                           
            eliminarPixFichero('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ');                                                                                                                                                                                                                                                                         
                 $('.txtEnlaceVideo').change(function (e) {                                  
                  cargarMiniaturaVideo($(this))                                                     
                 });                                                                         
                 $('.txtEnlaceVideo').keyup(function (e) {                                  
                  cargarMiniaturaVideo($(this))                                                     
                 });                                                                         
                 $('.txtEnlaceVideo').trigger('change');                                     
        }                                                                                                                                                                                                                                                                                                                         
       
       function cargarFancyConPermisospixFicherosProyectoWBTNNR89NKVRD7OS4CLJ(TOKEN, arrayPermisos) {                                                                                                                                                                                                                              
              var divFancyFicheros = $('#divFancyFicheros');                                                                                                                                                                                                                                   
              divFancyFicheros.attr('data-token', TOKEN);                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                           
              divFancyFicheros.empty();                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                               
              var divPixTarjeta = $('<div>', { class: 'pix-tarjeta' });                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                           
              var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Editar permisos');                                                                                                                                                         
              var iTitulo = $('<i>', { class: 'fas fa-cog' });                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                               
              tituloTarjeta.prepend(iTitulo);                                                                                                                                                                                                                                                  
              divPixTarjeta.append(tituloTarjeta);                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                               
              var divPixResultadosRegistros = $('<div>', { class: 'pix-resultados-registros' });                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                               
              $.each(arrayPermisos, function (i, permiso) {                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                               
                  var divPixRegistro = $('<div>', { 'class': 'pix-registro', 'data-id': permiso.ID });                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                               
                  var divPixRegistroImagen = $('<div>', { 'class': 'pix-registro-imagen' });                                                                                                                                                                                                   
                  var aImg = $('<a>', { 'href': '#' });                                                                                                                                                                                                                                        
                  aImg.append(permiso.LETRA);                                                                                                                                                                                                                                              
                  divPixRegistroImagen.append(aImg);                                                                                                                                                                                                                                           
                  divPixRegistro.append(divPixRegistroImagen);                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                               
                  var divPixRegistroContenido = $('<div>', { 'class': 'pix-registro-contenido' });                                                                                                                                                                                             
                  var aContenido = $('<a>', { 'href': '#' });                                                                                                                                                                                                                              
                  aContenido.append($('<strong>').html(permiso.ROL));                                                                                                                                                                                                                          
                  aContenido.append($('<p>').html(permiso.NUM_USUARIOS));                                                                                                                                                                                                                  
                  divPixRegistroContenido.append(aContenido);                                                                                                                                                                                                                                  
                  divPixRegistro.append(divPixRegistroContenido);                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                               
                  var divPixCombo = $('<div>', { 'class': 'cmb-permisos' });                                                                                                                                                                                                                   
                  var selectPermisos = $('<select>', { 'class': 'select-permisos', 'data-id': permiso.ID });                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                           
                  selectPermisos.append($('<option>', { 'value': '1' }).html('❌ Sin acceso'));                                                                                                                          
                  selectPermisos.append($('<option>', { 'value': '2' }).html('👁‍🗨 Lectura'));                                                                                                                           
                  selectPermisos.append($('<option>', { 'value': '3' }).html('✅ Escritura'));                                                                                                                           
                                                                                                                                                                                                                                                                                               
                  selectPermisos.val(permiso.TIPO).change();                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                               
                  divPixCombo.append(selectPermisos)                                                                                                                                                                                                                                           
                  divPixRegistro.append(divPixCombo);                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                               
                  divPixResultadosRegistros.append(divPixRegistro);                                                                                                                                                                                                                            
              });                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                               
              divPixTarjeta.append(divPixResultadosRegistros);                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                               
              var divGrid = $('<div>', { class: 'pix-grid pad-8' });                                                                                                                                                                                                                           
              var divPixFila = $('<div>', { class: 'pix-fila' });                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                           
              var divPixCelda = $('<div>', { 'class': 'pc-12 tb-12 mv-12' });                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                           
              divPixCelda = $('<div>', { 'class': 'pc-12 tb-12 mv-12' });                                                                                                                                                                                                                      
              var pixBtn = $('<button>', { 'type': 'submit', 'class': 'pix-btn pix-validar-form pix-btn-verde', 'id': 'btnGrabarPermisos', 'data-token': 'pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ' }).html('<i class="fas fa-save"></i>' + 'Guardar');                 
                                                                                                                                                                                                                                                                                               
              divPixCelda.append(pixBtn);                                                                                                                                                                                                                                                      
              divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                  
              divGrid.append(divPixFila);                                                                                                                                                                                                                                                      
              divPixTarjeta.append(divGrid);                                                                                                                                                                                                                                                   
              divFancyFicheros.append(divPixTarjeta);                                                                                                                                                                                                                                             
              grabarPermisos(TOKEN);                                                                                                                                                                                                                                                              
          }
       </script>
    <script src="//cdn.pixelinnova.com/pixelone/pix-ficheros.js?v=31082022"></script>
    <script src="//cdn.jsdelivr.net/npm/jquery.fancytree@2.36.1/dist/modules/jquery.fancytree.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>
    <script>
        function goBack() {
            window.location.href = "/index.html"; // Redirigir siempre al index.html
        }
    
        // Función para obtener los parámetros de la URL
        function obtenerParametroURL(nombre) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(nombre);
        }
    
        // Función para obtener los datos del empleado con el ID proporcionado
        function obtenerDatosEmpleadoPorID(id) {
            fetch(`/datos_empleado?id=${id}`)
                .then(response => response.json())
                .then(empleado => {
                    // Rellenar el formulario con los datos del empleado
                    document.getElementById('nombre').value = empleado[0].NOMBRE;
                    document.getElementById('apellido').value = empleado[0].APELLIDO;
                    document.getElementById('email').value = empleado[0].EMAIL;
                    document.getElementById('telefono').value = empleado[0].TELEFONO;
                    document.getElementById('fotoEmpleado').src = `./img/${empleado[0].IMG}`;
                    // Actualizar contadores de caracteres
                    actualizarContadores();
                })
                .catch(error => console.error('Error al obtener datos del empleado:', error));
        }
    
        // Función para prellenar el formulario con los datos del empleado
        function prellenarFormulario() {
            // Obtener el ID del empleado de la URL
            const idEmpleado = obtenerParametroURL('id');
            if (idEmpleado) {
                obtenerDatosEmpleadoPorID(idEmpleado);
            }
        }
    
        // Función para actualizar los contadores de caracteres
        function actualizarContadores() {
            const campos = document.querySelectorAll('input[type="text"], input[type="email"]');
            campos.forEach(input => {
                const contador = input.nextElementSibling;
                contador.textContent = `${input.value.length}/200`;
            });
        }
    
        // Llamar a la función para prellenar el formulario cuando se cargue la página
        window.onload = prellenarFormulario;
    
        // Manejar el envío del formulario
        document.getElementById('formularioEmpleado').addEventListener('submit', function(event) {
            event.preventDefault(); // Evitar el envío del formulario para poder validar
            const id = obtenerParametroURL('id'); // Obtener el ID del empleado
            const nombre = document.getElementById('nombre').value;
            const apellido = document.getElementById('apellido').value;
            const email = document.getElementById('email').value;
            const telefono = document.getElementById('telefono').value;
            const imagen = document.getElementById('imagen').files[0];

            const formData = new FormData();
        formData.append('id', id);
        formData.append('nombre', nombre);
        formData.append('apellido', apellido);
        formData.append('email', email);
        formData.append('telefono', telefono);
        formData.append('imagen', imagen);
            
    
            // Validar que los campos no estén vacíos
            if (nombre.trim() === '' || apellido.trim() === '' || email.trim() === '' || telefono.trim() === '') {
                alert('Por favor completa todos los campos');
                return;
            }
    
            // Enviar la solicitud al servidor con los datos del empleado
            fetch('/actualizar-empleado', {
    method: 'POST',
    body: formData
})
            .then(response => {
                if (response.ok) {
                    console.log('Empleado guardado correctamente');
                    // Recargar la página actual para reflejar los cambios
                    location.reload();
                } else {
                    console.error('Error al guardar empleado');
                    alert('Error al guardar empleado');
                }
            })
            .catch(error => {
                console.error('Error al enviar la solicitud:', error);
                alert('Error al enviar la solicitud');
            });
        });
    
        // Agregar eventos de entrada a cada campo para actualizar los contadores
        const campos = document.querySelectorAll('input[type="text"], input[type="email"]');
        campos.forEach(input => {
            input.addEventListener('input', () => {
                const contador = input.nextElementSibling;
                contador.textContent = `${input.value.length}/200`;
            });
        });

        // Recargar la página cuando se muestre después de volver atrás
        window.addEventListener('pageshow', function(event) {
            if (event.persisted) {
                location.reload();
            }
        });
    </script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="//cdn.pixelinnova.com/pixelone/pix-menu-deslizante.js"></script>
    <script src="//cdn.pixelinnova.com/pixelone/pix-sistema.js?v=01022023"></script>
    <script>$(document).ready(function () { cargarPixUpload('-1', '/pix-admin/pix-sistema/pix-sistema.ashx?funcion=cargar-fichero&rutaFisica=&baseUrl=');});</script>
    <script src="//cdn.pixelinnova.com/pixelone/ckeditor.classic.js"></script>
    <script>
        const editors = document.querySelectorAll('.txtCKeditor');
        editors.forEach((el) => {
            ClassicEditor
        .create(el, {
                    simpleUpload: { uploadUrl: '/pix-admin/pix-sistema/pix-sistema.ashx?funcion=cargar-fichero&ckeditor=1&token=-1' }
                })
                .catch(error => {
                    console.error(error);
                });
        });
        </script>
        
        <script src="//cdn.pixelinnova.com/pixelone/pix-ficheros.js?v=31082022"></script>
        <script src="//cdn.jsdelivr.net/npm/jquery.fancytree@2.36.1/dist/modules/jquery.fancytree.min.js"></script>
        <script src="//cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>
        <script>

            var nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ = -1;                                                                                                                                        
            var PERMISO_ROL_ACTUALpixFicherosProyectoWBTNNR89NKVRD7OS4CLJ = 2;                                                                                                                                        
                                                                                                                                                                                                             
            var pixFicheros = [];                                                                                                                                                                            
            var ficherosOK = 0;                                                                                                                                                                              
            var ficherosNOK = 0;                                                                                                                                                                             
            var resultadoFinal = '';                                                                                                                                                                         
                                                                                                                                                                                                             
            $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ .divArbolFicheros').fancytree({                                                                                                                 
                strings: {                                                                                                                                                                                   
                    loading: 'Cargando&#8230;',                                                                                                                                   
                    loadError: 'Error de carga',                                                                                                                               
                    moreData: 'Más&#8230;', noData: 'No hay datos.'                                                                               
                },                                                                                                                                                                                           
                                                                                                                                                                                                             
                source: { url :'/funciones.ashx?funcion=obtenerArbolPixFicheros&token=pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ', cache: false },                                                                 
                                                                                                                                                                                                             
                                                                                                                                                                                                             
                init: function (e, data) {                                                                                                                                                                   
                                                                                                                                                                                                             
                    if (nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ == -1) {                                                                                                                                                                  
                        var arrayFicherosPadres = data.tree.rootNode.children;                                                                                                                               
                        nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ = arrayFicherosPadres[0].key;                                                                                                                                             
                                                                                                                                                                                                             
                        obtenerFicherosDeNodo('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ',arrayFicherosPadres[0].key);                                                                                                          
                                                                                                                                                                                                             
                        actualizarMigas('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ',arrayFicherosPadres[0]);                                                                                                                    
                    } else {                                                                                                                                                                                 
                        obtenerFicherosDeNodo('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ',nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ);                                                                                                                          
                        var nodo = $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ').find('.divArbolFicheros').fancytree('getTree').getNodeByKey(nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ);                                                    
                        nodo.setActive();                                                                                                                                                                      
                        nodo.setExpanded();                                                                                                                                                                  
                    }                                                                                                                                                                                        
                                                                                                                                                                                                             
                },                                                                                                                                                                                           
                renderNode: function (e, data) {                                                                                                                                                             
                                                                                                                                                                                                             
                    $(data.node.span).attr('data-id', data.node.key);                                                                                                                                        
                                                                                                                                                            
                                                                                                                                                                                                             
                    var node = data.node;                                                                                                                                                                    
                    var spanIcono = $(node.span).find('span.fancytree-icon');                                                                                                                                
                    $(data.node.span).attr('data-token', node.data.token);                                                                                                                                        
                    if (node.data.urlImagen != undefined && node.data.urlMiniatura != null && node.data.urlMiniatura != '') {                                                                                
                        spanIcono.css({ 'border-radius': '50%', 'background': 'url(' + node.data.urlMiniatura + '?w=16&h=16&mode=crop&autorotate=1)' });                                                     
                    }                                                                                                                                                                                        
                                                                                                                                                                                                             
                },                                                                                                                                                                                           
                activate: function (e, data) {                                                                                                                                                               
                                                                                                                                                                                                             
                    var nodoActual = data.node;                                                                                                                                                              
                    nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ = nodoActual.key;                                                                                                                                                             
                                                                                                                                                                                                             
                                                                                                                                                                                                             
                    if (nodoActual.folder) {                                                                                                                                                                 
                        obtenerFicherosDeNodo('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ',data.node.key);                                                                                                                       
                    }                                                                                                                                                                                        
                                                                                                                                                                                                             
                    actualizarMigas('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ',$('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ').find('.divArbolFicheros').fancytree('getTree').getNodeByKey(nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ));                         
                    bindClickArchivoCarpetapixFicherosProyectoWBTNNR89NKVRD7OS4CLJ();                                                                                                                                                               
                                                                                                                                                                                                             
                                                                                                                                                                                                             
                },                                                                                                                                                                                           
                activeVisible: true, // Make sure, active nodes are visible (expanded)                                                                                                                       
                aria: true, // Enable WAI-ARIA support                                                                                                                                                       
                autoActivate: false, // Automatically activate a node when it is focused using keyboard                                                                                                      
                autoCollapse: true, // Automatically collapse all siblings, when a node is expanded                                                                                                          
                autoScroll: true, // Automatically scroll nodes into visible area                                                                                                                            
                clickFolderMode: 3, // 1:activate, 2:expand, 3:activate and expand, 4:activate (dblclick expands)                                                                                            
                checkbox: false, // Show check boxes                                                                                                                                                         
                checkboxAutoHide: undefined, // Display check boxes on hover only                                                                                                                            
                debugLevel: 1, // 0:quiet, 1:errors, 2:warnings, 3:infos, 4:debug                                                                                                                            
                disabled: false, // Disable control                                                                                                                                                          
                focusOnSelect: true, // Set focus when node is checked by a mouse click                                                                                                                      
                escapeTitles: false, // Escape `node.title` content for display                                                                                                                              
                generateIds: false, // Generate id attributes like <span id='fancytree-id-KEY'>                                                                                                              
                idPrefix: 'ft_', // Used to generate node id's like <span id='fancytree-id-<key>'>                                                                                                           
                icon: true, // Display node icons                                                                                                                                                            
                keyboard: false, // Support keyboard navigation                                                                                                                                              
                keyPathSeparator: '/', // Used by node.getKeyPath() and tree.loadKeyPath()                                                                                                                   
                minExpandLevel: 1, // 1: root node is not collapsible                                                                                                                                        
                quicksearch: false, // Navigate to next node by typing the first letters                                                                                                                     
                rtl: false, // Enable RTL (right-to-left) mode                                                                                                                                               
                selectMode: 1, // 1:single, 2:multi, 3:multi-hier                                                                                                                                            
                tabindex: '0', // Whole tree behaves as one single control                                                                                                                                   
                titlesTabbable: false, // Node titles can receive keyboard focus                                                                                                                             
                tooltip: true, // Use title as tooltip (also a callback could be specified)                                                                                                                  
                                                                                                                                                                                                             
            });                                                                                                                                                                                              
           
                                                                                                                                                                                                 
                                                                                                                                                                                           
                                                                                                                                                                                           
               function bindClickArchivoCarpetapixFicherosProyectoWBTNNR89NKVRD7OS4CLJ() {                                                                                                                                        
                   $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ a[data-carpeta]').on('click', function(e){                                                                                 
                       e.preventDefault();                                                                                                                                                 
                       var nodo = $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ').find('.divArbolFicheros').fancytree('getTree').getNodeByKey($(this).attr('data-carpeta'));                 
                       nodo.setActive();                                                                                                                                                         
                       nodo.setExpanded();                                                                                                                                                 
                                                                                                                                                                                           
                   });                                                                                                                                                                     
               }                                                                                                                                                                           
                                                                                                                                                                                           
               bindClickArchivoCarpetapixFicherosProyectoWBTNNR89NKVRD7OS4CLJ();                                                                                                                                                  
                                                                                                                                                                                           
                                                                                                                                                                                           
               bindBotonesCarpeta('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ');                                                                                                                                                       
                                                                                                                                                                                           
               $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ .btnCambiarVista').click(function (e) {                                                                                    
                   e.preventDefault();                                                                                                                                                     
                   $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ').find('.divListaFicheros').attr('class', 'divListaFicheros').addClass($(this).attr('data-vista'));                         
               });                                                                                                                                                                         
                                                                                                                                                                                           
                                                                                                                                                                                           
               Fancybox.defaults.buttons = ['close'];                                                                                                                                      
               Fancybox.defaults.preload = 0;                                                                                                                                              
               Fancybox.defaults.l10n = {                                                                                                                                                  
                   CLOSE: 'Cerrar',                                                                                                                       
                   NEXT: 'Siguiente',                                                                                                                           
                   PREV: 'Anterior',                                                                                                                      
                   TOGGLE_FULLSCREEN: 'Pantalla completa',                                                                                                      
                   TOGGLE_SLIDESHOW: 'Presentación',                                                                                                  
                   TOGGLE_ZOOM: 'Zoom',                                                                                                                         
                   TOGGLE_THUMBS: 'Miniaturas'                                                                                                            
               }                                                                                                                                                                                 
                                                                                                                                                                                           
                                                                                                                                                                                           
                                                                                                                                                                                           
                                                                                                                                                                                           
           
              function bindDraggablepixFicherosProyectoWBTNNR89NKVRD7OS4CLJ() {                                                                                                                                                              
                                                                                                                                                                                                      
              }                                                                                                                                                                                       
           
             function abrirFancyFicherospixFicherosProyectoWBTNNR89NKVRD7OS4CLJ() {                                                 
                 $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ .btnEditarPixFichero').unbind('click').click(function (e) {
                     $('#divFancyFicheros').removeAttr('data-token');                                                                        
                     e.preventDefault();                                                     
                     cargarContenidoFancypixFicherosProyectoWBTNNR89NKVRD7OS4CLJ($(this));   
                     Fancybox.show(                                                          
                         [                                                                   
                             {                                                               
                                 src: '#divFancyFicheros',                                   
                                 type: 'inline',                                             
                             }                                                               
                         ]                                                                   
                     );                                                                      
                 });                                                                         
                 $('#pixFicheros-pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ .btnEditarPermisos').unbind('click').click(function (e) {
                     e.preventDefault();                                                     
                     $('#divFancyFicheros').removeAttr('data-token');                        
                     obtenerPermisosPixFicheros('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ');  
                 });                                                                         
             }
             function cargarMiniaturaVideo(input) {                                                                                                                 
                 $.ajax({                                                                                                                                            
                     type: 'Get',                                                                                                                                    
                     url: '/funciones.ashx',                                                                                                                         
                     data: {                                                                                                                                         
                         'funcion': 'cargar-miniatura',                                                                                                              
                         'urlVideo': input.val()                                                                                                                     
                     },                                                                                                                                              
                     success: function (resultado) {                                                                                                                 
                         if (resultado.VALOR == 1) {                                                                                                                 
                             if ($('.imgMiniatura img').attr('src') != resultado.TEXTO) {                                                                            
                                 $('.imgMiniatura').remove();                                                                                                        
                                 input.closest('.pix-grid').prepend($('<div>', { 'class': 'imgMiniatura' }).append($('<img>', { 'src': resultado.TEXTO })));         
                             }                                                                                                                                       
                         } else {                                                                                                                                    
                             $('.imgMiniatura').remove();                                                                                                            
                         }                                                                                                                                           
                     }, error: function (resultado) {                                                                                                                
                         $('.imgMiniatura').remove();                                                                                                                
                         console.error('No se han podido cargar la miniatura del vídeo');                                                                            
                     }                                                                                                                                               
                 });                                                                                                                                                 
             }                                                                                                                                                       
           
                function cargarContenidoFancypixFicherosProyectoWBTNNR89NKVRD7OS4CLJ(pixFichero) {
                  var id = pixFichero.attr('data-id');                                                                                                                                                                                                                                                                                  
                  var tipo = pixFichero.attr('data-tipo');                                                                                                                                                                                                                                                                         
                  var nombre = pixFichero.attr('data-nombre');                                                                                                                                                                                                                                                                              
                  var enlace = pixFichero.attr('data-enlace');                                                                                                                                                                                                                                                                     
                  var target = pixFichero.attr('data-target');                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                 
                  var divFancyFicheros = $('#divFancyFicheros');                                                                                                                                                                                                                                                                            
                  divFancyFicheros.attr('data-token', 'pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ');                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                      
                  divFancyFicheros.empty();                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                      
                  var divPixTarjeta = $('<div>', { class: 'pix-tarjeta' });                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                      
                  if (tipo ==1) {                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                      
                    if (id == -1) {                                                                                                                                                                                                                                                                                              
                        var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Nueva carpeta');                                                                                                                                                                                        
                        var iTitulo = $('<i>', { class: 'fas fa-folder-plus' });                                                                                                                                                                                                                                                 
                    } else {                                                                                                                                                                                                                                                                                                          
                        var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Editar carpeta');                                                                                                                                                                                       
                        var iTitulo = $('<i>', { class: 'fas fa-folder' });                                                                                                                                                                                                                                                           
                    }                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                      
                  }                                                                                                                                                                                                                                                                                                                     
                  else if (tipo ==2) {                                                                                                                                                                                                                                                             
                    var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Editar imagen');                                                                                                                                                                                            
                    var iTitulo = $('<i>', { class: 'fas fa-image' });                                                                                                                                                                                                                                                                
                  }                                                                                                                                                                                                                                                                                                                
                  else if (tipo ==3) {                                                                                                                                                                                                                                                            
                    var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Editar archivo');                                                                                                                                                                                            
                    var iTitulo = $('<i>', { class: 'fas fa-file-edit' });                                                                                                                                                                                                                                                            
                  }                                                                                                                                                                                                                                                                                                                     
                  else if ((tipo ==6) || (tipo ==5)) {                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                      
                    if (id == -1) {                                                                                                                                                                                                                                                                                              
                        var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Nuevo vídeo');                                                                                                                                                                                          
                        var iTitulo = $('<i>', { class: 'fas fa-video' });                                                                                                                                                                                                                                                       
                    } else {                                                                                                                                                                                                                                                                                                     
                        var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Editar vídeo');                                                                                                                                                                                         
                        var iTitulo = $('<i>', { class: 'fas fa-video' });                                                                                                                                                                                                                                                       
                    }                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                      
                  } else {                                                                                                                                                                                                                                                                                                              
                    if (id == -1) {                                                                                                                                                                                                                                                                                              
                        var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Nuevo enlace');                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                 
                    } else {                                                                                                                                                                                                                                                                                                          
                        var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Editar enlace');                                                                                                                                                                                        
                    }                                                                                                                                                                                                                                                                                                                 
                    var iTitulo = $('<i>', { class: 'fas fa-link' });                                                                                                                                                                                                                                                                 
                  }                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                      
                  tituloTarjeta.prepend(iTitulo);                                                                                                                                                                                                                                                                                       
                  divPixTarjeta.append(tituloTarjeta);                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                      
                  var divGrid = $('<div>', { class: 'pix-grid pad-8' });                                                                                                                                                                                                                                                                
                  var divPixFila = $('<div>', { class: 'pix-fila' });                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                 
                  var divPixCelda = $('<div>', { 'class': 'pc-12 tb-12 mv-12' });                                                                                                                                                                                                                                                       
                  var divPixCampo = $('<div>', { 'class': 'pix-campo' });                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                      
                  divPixCampo.append($('<label>').html('Nombre'));                                                                                                                                                                                                                                     
                  if (id == -1)  {                                                                                                                                                                                                                                                                                                  
                    divPixCampo.append($('<input>', { 'name': 'nombre', 'type': 'text', 'class': 'txtNombre', 'required': 'required', 'maxlength': '255', 'data-error': 'Por favor, introduce el nombre' }));                                                                                                             
                                                                                                                                                                                                                                                                                                                                      
                  } else {                                                                                                                                                                                                                                                                                                              
                    divPixCampo.append($('<input>', { 'name': 'nombre', 'value': nombre, 'type': 'text', 'class': 'txtNombre', 'required': 'required', 'maxlength': '255', 'data-error': 'Por favor, introduce el nombre' }));                                                                                            
                  }                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                      
                  divPixCelda.append(divPixCampo);                                                                                                                                                                                                                                                                                      
                  divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                      
                  if ((tipo ==6) || (tipo == 5)) {                                                                                                                                                                                                     
                    divPixCelda = $('<div>', { 'class': 'pc-12 tb-12 mv-12' });                                                                                                                                                                                                                                                       
                    divPixCampo = $('<div>', { 'class': 'pix-campo' });                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                      
                    divPixCampo.append($('<label>').html('Enlace'));                                                                                                                                                                                                                                 
                    if (id == -1) {                                                                                                                                                                                                                                                                                              
                        divPixCampo.append($('<input>', { 'name': 'enlace', 'type': 'url', 'class': 'txtEnlace txtEnlaceVideo', 'required': 'required', 'maxlength': '500', 'data-error': 'Por favor, introduce una URL válida' }));                                                                                                                 
                                                                                                                                                                                                                                                                                                                                      
                    } else {                                                                                                                                                                                                                                                                                                          
                        divPixCampo.append($('<input>', { 'name': 'enlace', 'value': enlace, 'type': 'url', 'class': 'txtEnlace txtEnlaceVideo', 'required': 'required', 'maxlength': '500', 'data-error': 'Por favor, introduce una URL válida' }));                                                                                                
                                                                                                                                                                                                                                                                                                                                 
                    }                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                      
                    divPixCelda.append(divPixCampo);                                                                                                                                                                                                                                                                                  
                    divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                                                   
                  } else if (tipo == 4) {                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                      
                    divPixCelda = $('<div>', { 'class': 'pc-8 tb-12 mv-12' });                                                                                                                                                                                                                                                        
                    divPixCampo = $('<div>', { 'class': 'pix-campo' });                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                      
                    divPixCampo.append($('<label>').html('Enlace'));                                                                                                                                                                                                                                 
                    if (id == -1) {                                                                                                                                                                                                                                                                                              
                        divPixCampo.append($('<input>', { 'name': 'enlace', 'type': 'url', 'class': 'txtEnlace', 'required': 'required', 'maxlength': '500', 'data-error': 'Por favor, introduce una url válida' }));                                                                                                                 
                                                                                                                                                                                                                                                                                                                                      
                    } else {                                                                                                                                                                                                                                                                                                          
                        divPixCampo.append($('<input>', { 'name': 'enlace', 'value': enlace, 'type': 'url', 'class': 'txtEnlace', 'required': 'required', 'maxlength': '500', 'data-error': 'Por favor, introduce una url válida' }));                                                                                                
                    }                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                      
                    divPixCelda.append(divPixCampo);                                                                                                                                                                                                                                                                                  
                    divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                      
                    divPixCelda = $('<div>', { 'class': 'pc-4 tb-12 mv-12' });                                                                                                                                                                                                                                                        
                    divPixCampo = $('<div>', { 'class': 'pix-label-fija' });                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                      
                    var divCheck = $('<div>', { 'class': 'pix-check' });                                                                                                                                                                                                                                                              
                    var labelEnlaceExterno = $('<label>').html('Abrir en una nueva pestaña');                                                                                                                                                                                                                 
                    if (id!= -1 && !target) {                                                                                                                                                                                                                                                                               
                        labelEnlaceExterno.append($('<input>', { 'name': 'chkTarget', 'type': 'checkbox', 'class': 'chkTarget' }).prop('checked', false));                                                                                                                                                                            
                    } else {                                                                                                                                                                                                                                                                                                     
                        labelEnlaceExterno.append($('<input>', { 'name': 'chkTarget', 'type': 'checkbox', 'class': 'chkTarget' }).prop('checked', true));                                                                                                                                                                             
                        labelEnlaceExterno.append($('<span>', { 'class': 'pix-marcado' }));                                                                                                                                                                                                                                      
                    }                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                      
                    divCheck.append(labelEnlaceExterno);                                                                                                                                                                                                                                                                              
                    divPixCampo.append(divCheck);                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                      
                    divPixCelda.append(divPixCampo);                                                                                                                                                                                                                                                                                  
                    divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                      
                }                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                      
                if (id!= -1) {                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                      
                    divPixCelda = $('<div>', { 'class': 'pc-6 tb-12 mv-12' });                                                                                                                                                                                                                                                        
                    pixBtn = $('<button>', { 'type': 'submit', 'id': 'btnEliminarPixFichero', 'class': 'pix-btn', 'data-id': id, 'data-tipo': tipo }).html('<i class="fas fa-trash"></i>' + 'Eliminar');                                                                                             
                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                      
                    divPixCelda.append(pixBtn);                                                                                                                                                                                                                                                                                       
                    divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                      
                    divPixCelda = $('<div>', { 'class': 'pc-6 tb-12 mv-12' });                                                                                                                                                                                                                                                        
                    var pixBtn = $('<button>', { 'type': 'submit', 'id': 'btnGrabarPixFicheroFichero', 'class': 'pix-btn pix-validar-form pix-btn-verde', 'data-id': id, 'data-tipo': tipo, 'data-id-padre': nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ }).html('<i class="fas fa-save"></i>' + 'Guardar');                   
                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                      
                    divPixCelda.append(pixBtn);                                                                                                                                                                                                                                                                                       
                    divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                      
                } else {                                                                                                                                                                                                                                                                                                              
                    divPixCelda = $('<div>', { 'class': 'pc-12 tb-12 mv-12' });                                                                                                                                                                                                                                                       
                    var pixBtn = $('<button>', { 'type': 'submit', 'id': 'btnGrabarPixFicheroFichero', 'class': 'pix-btn pix-validar-form pix-btn-verde', 'data-id': id, 'data-tipo': tipo, 'data-id-padre': nodoActivopixFicherosProyectoWBTNNR89NKVRD7OS4CLJ }).html('<i class="fas fa-save"></i>' + 'Guardar');                 
                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                      
                    divPixCelda.append(pixBtn);                                                                                                                                                                                                                                                                                       
                    divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                                                   
                }                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                      
                divGrid.append(divPixFila);                                                                                                                                                                                                                                                                                           
                divPixTarjeta.append(divGrid);                                                                                                                                                                                                                                                                                        
                divFancyFicheros.append(divPixTarjeta);                                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                      
                cargarCampos();                                                                                                                                                                                                                                                                                                       
                grabarPixFichero('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ');                                                                                                                                                                                                                                                                           
                eliminarPixFichero('pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ');                                                                                                                                                                                                                                                                         
                     $('.txtEnlaceVideo').change(function (e) {                                  
                      cargarMiniaturaVideo($(this))                                                     
                     });                                                                         
                     $('.txtEnlaceVideo').keyup(function (e) {                                  
                      cargarMiniaturaVideo($(this))                                                     
                     });                                                                         
                     $('.txtEnlaceVideo').trigger('change');                                     
            }                                                                                                                                                                                                                                                                                                                         
           
           function cargarFancyConPermisospixFicherosProyectoWBTNNR89NKVRD7OS4CLJ(TOKEN, arrayPermisos) {                                                                                                                                                                                                                              
                  var divFancyFicheros = $('#divFancyFicheros');                                                                                                                                                                                                                                   
                  divFancyFicheros.attr('data-token', TOKEN);                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                               
                  divFancyFicheros.empty();                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                   
                  var divPixTarjeta = $('<div>', { class: 'pix-tarjeta' });                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                               
                  var tituloTarjeta = $('<div>', { class: 'pix-tarjeta-titulo' }).html('Editar permisos');                                                                                                                                                         
                  var iTitulo = $('<i>', { class: 'fas fa-cog' });                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                   
                  tituloTarjeta.prepend(iTitulo);                                                                                                                                                                                                                                                  
                  divPixTarjeta.append(tituloTarjeta);                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                   
                  var divPixResultadosRegistros = $('<div>', { class: 'pix-resultados-registros' });                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                   
                  $.each(arrayPermisos, function (i, permiso) {                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                   
                      var divPixRegistro = $('<div>', { 'class': 'pix-registro', 'data-id': permiso.ID });                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                   
                      var divPixRegistroImagen = $('<div>', { 'class': 'pix-registro-imagen' });                                                                                                                                                                                                   
                      var aImg = $('<a>', { 'href': '#' });                                                                                                                                                                                                                                        
                      aImg.append(permiso.LETRA);                                                                                                                                                                                                                                              
                      divPixRegistroImagen.append(aImg);                                                                                                                                                                                                                                           
                      divPixRegistro.append(divPixRegistroImagen);                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                   
                      var divPixRegistroContenido = $('<div>', { 'class': 'pix-registro-contenido' });                                                                                                                                                                                             
                      var aContenido = $('<a>', { 'href': '#' });                                                                                                                                                                                                                              
                      aContenido.append($('<strong>').html(permiso.ROL));                                                                                                                                                                                                                          
                      aContenido.append($('<p>').html(permiso.NUM_USUARIOS));                                                                                                                                                                                                                  
                      divPixRegistroContenido.append(aContenido);                                                                                                                                                                                                                                  
                      divPixRegistro.append(divPixRegistroContenido);                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                   
                      var divPixCombo = $('<div>', { 'class': 'cmb-permisos' });                                                                                                                                                                                                                   
                      var selectPermisos = $('<select>', { 'class': 'select-permisos', 'data-id': permiso.ID });                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                               
                      selectPermisos.append($('<option>', { 'value': '1' }).html('❌ Sin acceso'));                                                                                                                          
                      selectPermisos.append($('<option>', { 'value': '2' }).html('👁‍🗨 Lectura'));                                                                                                                           
                      selectPermisos.append($('<option>', { 'value': '3' }).html('✅ Escritura'));                                                                                                                           
                                                                                                                                                                                                                                                                                                   
                      selectPermisos.val(permiso.TIPO).change();                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                   
                      divPixCombo.append(selectPermisos)                                                                                                                                                                                                                                           
                      divPixRegistro.append(divPixCombo);                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                   
                      divPixResultadosRegistros.append(divPixRegistro);                                                                                                                                                                                                                            
                  });                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                   
                  divPixTarjeta.append(divPixResultadosRegistros);                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                   
                  var divGrid = $('<div>', { class: 'pix-grid pad-8' });                                                                                                                                                                                                                           
                  var divPixFila = $('<div>', { class: 'pix-fila' });                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                               
                  var divPixCelda = $('<div>', { 'class': 'pc-12 tb-12 mv-12' });                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                               
                  divPixCelda = $('<div>', { 'class': 'pc-12 tb-12 mv-12' });                                                                                                                                                                                                                      
                  var pixBtn = $('<button>', { 'type': 'submit', 'class': 'pix-btn pix-validar-form pix-btn-verde', 'id': 'btnGrabarPermisos', 'data-token': 'pixFicherosProyectoWBTNNR89NKVRD7OS4CLJ' }).html('<i class="fas fa-save"></i>' + 'Guardar');                 
                                                                                                                                                                                                                                                                                                   
                  divPixCelda.append(pixBtn);                                                                                                                                                                                                                                                      
                  divPixFila.append(divPixCelda);                                                                                                                                                                                                                                                  
                  divGrid.append(divPixFila);                                                                                                                                                                                                                                                      
                  divPixTarjeta.append(divGrid);                                                                                                                                                                                                                                                   
                  divFancyFicheros.append(divPixTarjeta);                                                                                                                                                                                                                                             
                  grabarPermisos(TOKEN);                                                                                                                                                                                                                                                              
              }
           </script>
           <script src="//cdn.pixelinnova.com/pixelone/pix-sistema.js"></script>
           <script>
            // Escuchar el evento focus en los campos de entrada
            document.querySelectorAll('.pix-campo input').forEach(input => {
                input.addEventListener('focus', () => {
                    input.parentNode.classList.add('active');
                });
    
                // Escuchar el evento blur para detectar cuando el campo pierde el foco
                input.addEventListener('blur', () => {
                    if (!input.value.trim()) {
                        input.parentNode.classList.remove('active');
                    }
                });
            });
        </script>

</body>

</html>
